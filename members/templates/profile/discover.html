{% extends 'base/base.html' %}
{% load static %}

{% block title %}Discover{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/discover.css' %}">
{% endblock %}

{% block content %}
<div class="discover-page py-4">
    <div class="discover-header d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
        <div class="discover-header__intro d-flex flex-column gap-3">
            <div>
                <h1 class="discover-title mb-2">Свайпайте та знайомтеся</h1>
                <p class="text-muted mb-0">Вправо — подобається, вліво — пропустити. Лише ви і картки з людьми поруч.</p>
            </div>
            <div class="discover-header__actions d-flex align-items-center gap-2">
                <button type="button" class="btn btn-outline-primary discover-filter-toggle" data-filter-toggle aria-haspopup="dialog" aria-controls="discover-filter-panel" aria-expanded="false">
                    <i class="bi bi-sliders"></i>
                    <span class="ms-2">Фільтри</span>
                </button>
            </div>
        </div>
        <div class="result-counter text-lg-end">
            <span class="result-counter__number" data-results-count>{{ members_data|length }}</span>
            <span class="result-counter__label">кандидатів</span>
        </div>
    </div>

    <div class="swipe-area mt-4">
        <div class="swipe-feedback" data-action-feedback role="status" aria-live="polite"></div>
        <div class="card-stack position-relative" data-card-stack>
            <div class="empty-state{% if members_data %} d-none{% endif %}" data-empty-state>
                <div class="empty-state__inner">
                    <i class="bi bi-emoji-smile"></i>
                    <h2>Поки що нікого поблизу</h2>
                    <p class="mb-0">Загляньте пізніше — хтось особливий точно з’явиться.</p>
                </div>
            </div>
            <noscript>
                <div class="alert alert-info mt-3">Для свайпів увімкніть JavaScript у браузері.</div>
            </noscript>
        </div>

        <div class="swipe-actions mt-4">
            <div class="swipe-actions__buttons d-flex justify-content-center flex-wrap gap-3">
                <button type="button" class="btn btn-outline-secondary btn-lg swipe-button" data-action="dislike">
                    <i class="bi bi-x-lg"></i>
                    <span class="ms-2">Пропустити</span>
                </button>
                <button type="button" class="btn btn-outline-dark btn-lg swipe-button" data-action="rewind" disabled>
                    <i class="bi bi-arrow-counterclockwise"></i>
                    <span class="ms-2">Повернути</span>
                </button>
                <button type="button" class="btn btn-primary btn-lg swipe-button" data-action="like">
                    <i class="bi bi-heart-fill"></i>
                    <span class="ms-2">Вподобати</span>
                </button>
            </div>
        </div>
    </div>

    <div class="discover-filter-overlay" data-filter-overlay></div>
    <aside class="discover-filters" id="discover-filter-panel" data-filter-panel role="dialog" aria-modal="true" aria-hidden="true">
        <div class="discover-filters__header d-flex align-items-center justify-content-between">
            <div>
                <h2 class="discover-filters__title">Фільтри</h2>
                <p class="discover-filters__subtitle text-muted mb-0">Підберіть людей за вашими критеріями</p>
            </div>
            <button type="button" class="btn-close" aria-label="Закрити фільтри" data-filter-close></button>
        </div>

        <form class="discover-filters__form" data-filter-form>
            <section class="discover-filters__section">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h3 class="discover-filters__section-title">Відстань</h3>
                    <span class="discover-filters__value" data-distance-value>Будь-яка</span>
                </div>
                <input type="range" class="form-range" min="5" max="500" step="5" value="500" data-distance data-default-value="500" data-unlimited-value="500" aria-label="Максимальна відстань, кілометри">
            </section>

            <section class="discover-filters__section">
                <h3 class="discover-filters__section-title">Місцезнаходження</h3>
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label" for="discover-filter-country">Країна</label>
                        <select class="form-select" id="discover-filter-country" data-country>
                            <option value="">Усі країни</option>
                            {% for country in countries %}
                                <option value="{{ country.id }}">{{ country.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label" for="discover-filter-city">Місто</label>
                        <select class="form-select" id="discover-filter-city" data-city disabled>
                            <option value="">Усі міста</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="discover-filters__section">
                <h3 class="discover-filters__section-title">Вік</h3>
                <div class="row g-3">
                    <div class="col-6">
                        <label class="form-label" for="discover-filter-min-age">Від</label>
                        <input type="number" class="form-control" id="discover-filter-min-age" min="18" max="99" placeholder="18" data-min-age>
                    </div>
                    <div class="col-6">
                        <label class="form-label" for="discover-filter-max-age">До</label>
                        <input type="number" class="form-control" id="discover-filter-max-age" min="18" max="99" placeholder="99" data-max-age>
                    </div>
                </div>
            </section>

            <section class="discover-filters__section">
                <h3 class="discover-filters__section-title">Стать</h3>
                <label class="form-label" for="discover-filter-gender">Показувати</label>
                <select class="form-select" id="discover-filter-gender" data-looking-for>
                    <option value="any">Будь-яка</option>
                    <option value="female">Жінок</option>
                    <option value="male">Чоловіків</option>
                </select>
            </section>

            <section class="discover-filters__section">
                <h3 class="discover-filters__section-title">Інтереси</h3>
                {% if interests %}
                    <div class="discover-filters__chips" role="group" aria-label="Інтереси">
                        {% for interest in interests %}
                            <div class="form-check discover-filters__chip">
                                <input class="form-check-input" type="checkbox" value="{{ interest }}" id="discover-interest-{{ forloop.counter }}" data-interest-filter>
                                <label class="form-check-label" for="discover-interest-{{ forloop.counter }}">{{ interest }}</label>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted mb-0">Інтереси користувачів ще не додані. Діліться своїми, щоб знаходити більше збігів.</p>
                {% endif %}
            </section>

            <div class="discover-filters__footer d-flex flex-column flex-sm-row align-items-stretch align-items-sm-center justify-content-between gap-3">
                <button type="button" class="btn btn-link text-decoration-none px-0" data-reset-filters>Скинути все</button>
                <button type="button" class="btn btn-primary" data-filter-close>Показати результати</button>
            </div>
        </form>
    </aside>
</div>

{{ members_data|json_script:"discover-data" }}
{% endblock %}

{% block scripts %}
<script src="{% static 'js/swipe_deck.js' %}"></script>
{% endblock %}
